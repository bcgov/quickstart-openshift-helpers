# Setting Up a Vanity or Custom URL

## Generating a Request

Ticketing and administrative steps are for the Natural Resources only.  Other ministries will have their own processes.

Steps:
1. Create a certificate signing request (CSR) and private key using `./csr_generator.sh`.
   - This generates both `<DOMAIN>.csr` and `<DOMAIN>.key` files
   - Example: Running `./csr_generator.sh silva.nrs.gov.bc.ca` creates `silva.nrs.gov.bc.ca.csr` and `silva.nrs.gov.bc.ca.key`
2. Create a [JIRA issue](https://apps.nrs.gov.bc.ca/int/jira/secure/CreateIssue!default.jspa).
3. Provide details, which are glossed over in the script from step 1.
4. Attach the CSR file generated in step 1.
5. Wait, answering questions or following up as necessary.

## Installing the Certificate

These steps should work for any OpenShift (and hopefully Kubernetes!) setup.  Certificates must have already been provided by your ministry's administrators.

### Preparing Certificate Files

After receiving certificates from your administrators (via JIRA response), you need to prepare the files with the correct naming:

**Files you should have received:**
- End-entity certificate (usually in PEM format, may be `.txt`, `.pem`, `.crt`, or `.cert`)
- CA certificate files (typically named like `1-OV TLS CA 2.txt` and `2-Sectigo Public Server Root.txt`)

**Files you already have:**
- `<DOMAIN>.csr` - Generated by `csr_generator.sh`
- `<DOMAIN>.key` - Generated by `csr_generator.sh` (private key)

**File renaming required:**
1. Copy or rename your end-entity certificate to `<DOMAIN>.cert`
   - Example: If you received a PEM file for `silva.nrs.gov.bc.ca`, rename it to `silva.nrs.gov.bc.ca.cert`
2. Copy the intermediate CA certificate to `<DOMAIN>.ca-cert`
   - Use `1-OV TLS CA 2.txt` (the certificate that directly issued your end-entity certificate)
   - Example: `cp "1-OV TLS CA 2.txt" "silva.nrs.gov.bc.ca.ca-cert"`
   - If validation fails, you may need to concatenate both intermediate CA files:
     ```bash
     cat "1-OV TLS CA 2.txt" "2-Sectigo Public Server Root.txt" > "silva.nrs.gov.bc.ca.ca-cert"
     ```

**Final files required:**
- `<DOMAIN>.csr` - From `Generating a Request` step
- `<DOMAIN>.key` - From `Generating a Request` step (private key)
- `<DOMAIN>.cert` - Renamed from certificate received from administrators
- `<DOMAIN>.ca-cert` - Renamed from `1-OV TLS CA 2.txt` (or concatenated CA chain)

### Installation Steps

1. Ensure all required files are prepared with correct naming (see above)
2. Login to [OpenShift](https://console.apps.silver.devops.gov.bc.ca/k8s/cluster/projects)
3. Switch to the appropriate namespace: `oc project <namespace>`
4. Install the certificate using `./install_cert.sh`

## Reinstall and Renewals

Retain all four certificate-related files (csr, key, cert, ca-cert).  All four are required for reinstallation or recovery of deleted OpenShift routes.  The csr and key files are required with future certificate renewals.  Use `./install_cert.sh` as required.


## Reference

[How do I get a custom vanity URL for my application in Openshift?](https://stackoverflow.developer.gov.bc.ca/questions/172/176)

[Creating government web presences](https://www2.gov.bc.ca/gov/content/governments/services-for-government/service-experience-digital-delivery/digital-delivery/web-property-process)

[Order Domain Name Registration and Domain Name Services Article](https://ociomysc.service-now.com/sp?id=ocio_sr_kb_article_view&sysparm_article=KB0031620&sys_kb_id=c66a12a8db4c0510fa8619381396197f&spa=1)

[OCP 4 platform network topology](https://digital.gov.bc.ca/cloud/services/private/internal-resources/topology/)

[SSL Certificates for https://system.eao.gov.bc.ca/](https://apps.nrs.gov.bc.ca/int/jira/browse/SD-96171)

[How to update route TLS certificate from CLI?](https://stackoverflow.developer.gov.bc.ca/questions/239)
